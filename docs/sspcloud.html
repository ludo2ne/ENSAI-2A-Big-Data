<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ludovic Deneuville">
<meta name="description" content="TP Découverte du datalab SSPCloud">

<title>Big Data - Datalab SSPCloud</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Big Data</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-labs" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Labs</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-labs">    
        <li>
    <a class="dropdown-item" href="../docs/lab/lab-setup.html">
 <span class="dropdown-text">Lab setup</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../docs/lab/lab0/lab0.html">
 <span class="dropdown-text">Lab 0</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../docs/lab/lab1/lab1.html">
 <span class="dropdown-text">Lab 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../docs/lab/lab2/lab2.html">
 <span class="dropdown-text">Lab 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../docs/lab/lab3/lab3.html">
 <span class="dropdown-text">Lab 3</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-aws" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">AWS</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-aws">    
        <li>
    <a class="dropdown-item" href="../docs/lab/aws-cluster-spark.html">
 <span class="dropdown-text">Create a Spark cluster</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../docs/lab/aws-stream-simulation.html">
 <span class="dropdown-text">Stream Simulation AWS</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../docs/lab/ssp-stream-simulation.html">
 <span class="dropdown-text">Stream Simulation SSP</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-other-resources" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Other resources</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-other-resources">    
        <li>
    <a class="dropdown-item" href="../docs/sspcloud.html">
 <span class="dropdown-text">SSPCloud</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../docs/duckdb.html">
 <span class="dropdown-text">DuckDB</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../docs/resources.html"> 
<span class="menu-text">Useful resources</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/ludo2ne/ENSAI-2A-Big-Data" target="_blank"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="3">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#créer-et-configuration-de-compte" id="toc-créer-et-configuration-de-compte" class="nav-link" data-scroll-target="#créer-et-configuration-de-compte"><span class="header-section-number">1</span> Créer et configuration de compte</a>
  <ul class="collapse">
  <li><a href="#générer-un-token-github" id="toc-générer-un-token-github" class="nav-link" data-scroll-target="#générer-un-token-github"><span class="header-section-number">1.1</span> Générer un token GitHub</a></li>
  <li><a href="#déclarer-votre-jeton" id="toc-déclarer-votre-jeton" class="nav-link" data-scroll-target="#déclarer-votre-jeton"><span class="header-section-number">1.2</span> Déclarer votre jeton</a></li>
  </ul></li>
  <li><a href="#le-stockage" id="toc-le-stockage" class="nav-link" data-scroll-target="#le-stockage"><span class="header-section-number">2</span> Le stockage</a>
  <ul class="collapse">
  <li><a href="#votre-bucket" id="toc-votre-bucket" class="nav-link" data-scroll-target="#votre-bucket"><span class="header-section-number">2.1</span> Votre bucket</a></li>
  <li><a href="#stocker-des-fichiers" id="toc-stocker-des-fichiers" class="nav-link" data-scroll-target="#stocker-des-fichiers"><span class="header-section-number">2.2</span> Stocker des fichiers</a></li>
  </ul></li>
  <li><a href="#les-services" id="toc-les-services" class="nav-link" data-scroll-target="#les-services"><span class="header-section-number">3</span> Les services</a>
  <ul class="collapse">
  <li><a href="#dépôt-pour-le-code" id="toc-dépôt-pour-le-code" class="nav-link" data-scroll-target="#dépôt-pour-le-code"><span class="header-section-number">3.1</span> Dépôt pour le code</a></li>
  <li><a href="#créer-un-service" id="toc-créer-un-service" class="nav-link" data-scroll-target="#créer-un-service"><span class="header-section-number">3.2</span> Créer un service</a></li>
  <li><a href="#jouer-avec-votre-service" id="toc-jouer-avec-votre-service" class="nav-link" data-scroll-target="#jouer-avec-votre-service"><span class="header-section-number">3.3</span> Jouer avec votre service</a></li>
  <li><a href="#accéder-à-votre-stockage" id="toc-accéder-à-votre-stockage" class="nav-link" data-scroll-target="#accéder-à-votre-stockage"><span class="header-section-number">3.4</span> Accéder à votre stockage</a></li>
  <li><a href="#client-minio" id="toc-client-minio" class="nav-link" data-scroll-target="#client-minio"><span class="header-section-number">3.5</span> Client MinIO</a></li>
  <li><a href="#sauver-son-code" id="toc-sauver-son-code" class="nav-link" data-scroll-target="#sauver-son-code"><span class="header-section-number">3.6</span> Sauver son code</a></li>
  <li><a href="#surveiller-son-service" id="toc-surveiller-son-service" class="nav-link" data-scroll-target="#surveiller-son-service"><span class="header-section-number">3.7</span> Surveiller son service</a></li>
  <li><a href="#terminer-son-service" id="toc-terminer-son-service" class="nav-link" data-scroll-target="#terminer-son-service"><span class="header-section-number">3.8</span> Terminer son service</a></li>
  </ul></li>
  <li><a href="#les-secrets" id="toc-les-secrets" class="nav-link" data-scroll-target="#les-secrets"><span class="header-section-number">4</span> Les secrets</a>
  <ul class="collapse">
  <li><a href="#créer-un-secret" id="toc-créer-un-secret" class="nav-link" data-scroll-target="#créer-un-secret"><span class="header-section-number">4.1</span> Créer un secret</a></li>
  <li><a href="#utiliser-dans-un-service" id="toc-utiliser-dans-un-service" class="nav-link" data-scroll-target="#utiliser-dans-un-service"><span class="header-section-number">4.2</span> Utiliser dans un service</a></li>
  </ul></li>
  <li><a href="#pour-aller-plus-loin" id="toc-pour-aller-plus-loin" class="nav-link" data-scroll-target="#pour-aller-plus-loin">Pour aller plus loin</a>
  <ul class="collapse">
  <li><a href="#le-projet-onyxia-de-a-à-z" id="toc-le-projet-onyxia-de-a-à-z" class="nav-link" data-scroll-target="#le-projet-onyxia-de-a-à-z">Le projet Onyxia de A à Z</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Datalab SSPCloud</h1>
</div>

<div>
  <div class="description">
    TP Découverte du datalab SSPCloud
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Ludovic Deneuville </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="introduction">Introduction</h2>
<p>Le <a href="https://datalab.sspcloud.fr/" target="_blank">datalab SSP Cloud</a> a été créé pour permettre aux statisticiens de la sphère publique et aux étudiants de découvrir, d’expérimenter, d’apprendre, de se former aux outils de la data.</p>
<p>Le principe est d’offrir aux utilisateurs de nombreux services (Jupyter, Rstudio, VSCode, PostgreSQL…) à la demande et une puissance de calcul adaptée aux besoins.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>Ces services sont éphémères, car si les ressources sont importantes, il faut savoir les partager !</p>
<p>Le principe général est le suivant :</p>
<ul>
<li>Vous lancez votre service en réservant des ressources (CPU, GPU, RAM)</li>
<li>Vous effectuez votre travail</li>
<li>Vous sauvegardez votre code (git) et vos résultats (MinIO)</li>
<li>Vous supprimez votre service et libérez les ressources</li>
</ul>
</div>
</div>
<p>Ce datalab est une implémentation d’<a href="https://www.onyxia.sh/" target="_blank">Onyxia</a>, projet Open source initié et porté par le <a href="https://github.com/InseeFrLab" target="_blank">lab de l’INSEE</a>.</p>
<p>Onyxia s’appuie sur des technologies sous-jacentes (Kubernetes, Helm, S3…) pour proposer une interface agréable pour le datascientist. Cependant la philosophie du projet Onyxia est d’être une brique qui facilite le travail sans se rendre indispensable.</p>
</section>
<section id="créer-et-configuration-de-compte" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="créer-et-configuration-de-compte"><span class="header-section-number">1</span> Créer et configuration de compte</h2>
<p>Pour profiter des services, vous devez créer un compte.</p>
<section id="générer-un-token-github" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="générer-un-token-github"><span class="header-section-number">1.1</span> Générer un token GitHub</h3>
<p>Sur le datalab, vos services ont une durée de vie limitée.</p>
<p>Pour sauvegarder vos programmes, la bonne pratique est d’utiliser un dépôt git. Nous allons donc utiliser créer et utiliser un jeton pour communiquer avec GitHub.</p>
<p>Pour suivre la démarche, il faut disposer d’un compte <a href="https://github.com/" target="_blank">GitHub</a>. Il est possible de suivre une démarche similaire avec <a href="https://about.gitlab.com/" target="_blank">GitLab</a>.</p>
<ul class="task-list">
<li><label><input type="checkbox">Connectez-vous à votre compte GitHub</label></li>
<li><label><input type="checkbox">Allez dans settings &gt; Developer settings &gt; Personal access tokens &gt; Tokens (classic)</label></li>
<li><label><input type="checkbox">Générez un <a href="https://github.com/settings/tokens/new" target="_blank">nouveau jeton classique</a></label>
<ul>
<li>Renseigner : nom du token, date d’expiration</li>
<li><span class="emoji" data-emoji="white_check_mark">✅</span> Cochez repo</li>
<li>Cliquez sur <code>Generate token</code></li>
<li>Copiez ce jeton commençant par “<em>ghp_</em>” et gardez le précieusement de côté quelques minutes</li>
</ul></li>
</ul>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Ce jeton ne sera visible qu’une seule fois</li>
<li>si vous le perdez ou s’il est expiré, il faut en générer un nouveau</li>
</ul>
</div>
</div>
</section>
<section id="déclarer-votre-jeton" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="déclarer-votre-jeton"><span class="header-section-number">1.2</span> Déclarer votre jeton</h3>
<p>GitHub vous a fournit un jeton. Il faut maintenant le déclarer sur le <a href="https://datalab.sspcloud.fr/" target="_blank">Datalab</a> (<a href="https://inseefrlab.github.io/docs.sspcloud.fr/docs/fr/version-control.html" target="_blank">Doc officielle</a>) :</p>
<ul class="task-list">
<li><label><input type="checkbox">Allez dans <code>Mon Compte</code> &gt; Onglet <code>Git</code></label></li>
<li><label><input type="checkbox">Renseignez les informations suivantes</label>
<ul>
<li>nom d’utilisateur Git</li>
<li>mail (celui utilisé pour votre compte GitHub)</li>
</ul></li>
<li><label><input type="checkbox">Collez votre token</label></li>
</ul>
</section>
</section>
<section id="le-stockage" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="le-stockage"><span class="header-section-number">2</span> Le stockage</h2>
<p>Lorsque l’on travaille dans le cloud, il est essentiel de séparer les données des programmes pour mieux gérer les ressources, renforcer la sécurité en limitant les accès et les permissions, et permettre une scalabilité indépendante des composants.</p>
<p><a href="https://min.io/" target="_blank">MinIO</a> est une solution de stockage d’objets open-source qui permet de déployer facilement un stockage évolutif et performant. Elle est compatible avec l’API <a href="https://aws.amazon.com/fr/s3/" target="_blank">S3 d’Amazon</a>, ce qui facilite l’intégration avec les applications existantes. MinIO offre une haute disponibilité, une sécurité renforcée grâce au chiffrement des données et des contrôles d’accès, et des performances élevées, particulièrement adaptées aux environnements nécessitant un accès rapide aux données, comme le Big Data et l’intelligence artificielle.</p>
<section id="votre-bucket" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="votre-bucket"><span class="header-section-number">2.1</span> Votre bucket</h3>
<p>Lors de votre création de compte, un bucket est créé avec votre nom d’utilisateur. Dans ce bucket, vous pouvez :</p>
<ul>
<li>créer / supprimer des dossiers</li>
<li>importer / supprimer des fichiers</li>
<li>créer un dossier nommé <code>diffusion</code> à la racine de votre bucket
<ul>
<li>celui-ci sera accessible en lecture à tous les utilisateurs du datalab</li>
</ul></li>
</ul>
<p>Pour accéder à votre stockage :</p>
<ul>
<li>Depuis le Datalab, allez dans <code>Mes fichiers</code></li>
<li>Depuis la <a href="https://minio-console.lab.sspcloud.fr/" target="_blank">console MinIO</a></li>
<li>Depuis le terminal d’un service (voir <a href="#Accéder-à-votre-stockage">section ci-après</a>)</li>
</ul>
</section>
<section id="stocker-des-fichiers" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="stocker-des-fichiers"><span class="header-section-number">2.2</span> Stocker des fichiers</h3>
<ul class="task-list">
<li><label><input type="checkbox">Téléchargez le <a href="https://www.insee.fr/fr/statistiques/7633685">fichier des prénoms par département de naissance</a> en 2022 au format csv</label></li>
<li><label><input type="checkbox">Dans votre bucket, créez un dossier <code>diffusion</code>, puis à l’intérieur un dossier <code>INSEE</code></label></li>
<li><label><input type="checkbox">Dans ce dossier, importez le fichier des prénoms</label></li>
</ul>
</section>
</section>
<section id="les-services" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="les-services"><span class="header-section-number">3</span> Les services</h2>
<section id="dépôt-pour-le-code" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="dépôt-pour-le-code"><span class="header-section-number">3.1</span> Dépôt pour le code</h3>
<p>Avant de créer un service, nous allons créer un dépôt GitHub qui permettra de sauvegarder votre code.</p>
<ul class="task-list">
<li><label><input type="checkbox">Dans GitHub, créer un <a href="https://github.com/new" target="_blank">nouveau Repository</a></label>
<ul>
<li>Repository name : TP-datalab</li>
<li>Public</li>
<li>Cochez <em>Add a README file</em></li>
<li>.gitignore template : R</li>
<li>Choose a license : Apache Licence 2.0</li>
<li><code>Create Repository</code></li>
</ul></li>
<li><label><input type="checkbox">Sur la page de votre repo, cliquez sur le bouton <strong><span style="background-color: green">Code</span></strong></label></li>
<li><label><input type="checkbox">Copiez l’adresse <em>https</em> du repo</label></li>
</ul>
</section>
<section id="créer-un-service" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="créer-un-service"><span class="header-section-number">3.2</span> Créer un service</h3>
<ul class="task-list">
<li><label><input type="checkbox">Allez dans <code>Catalogue de services</code>, sélectionner le service <em>Rstudio</em>, puis cliquez sur <code>Lancer</code></label></li>
<li><label><input type="checkbox">Allez dans Configuration</label>
<ul>
<li>De nombreux onglets permettent de configurer votre service</li>
<li>Service : possibilité d’utiliser une autre image Docker</li>
<li>Resources : choisir CPU et RAM</li>
<li>Init : script à lancer au démarrage</li>
</ul></li>
<li><label><input type="checkbox">Allez dans l’onglet <code>Git</code> et collez l’adresse <em>https</em> du repo</label></li>
<li><label><input type="checkbox">Lancez le service</label>
<ul>
<li>Attendez quelques secondes le temps que le service se lance</li>
</ul></li>
<li><label><input type="checkbox">Cliquez pour copier le mot de passe</label></li>
<li><label><input type="checkbox">Cliquez sur <code>Ouvrir le service</code> <span class="emoji" data-emoji="rocket">🚀</span></label>
<ul>
<li>username : onyxia</li>
<li>password : collez le mot de passe</li>
</ul></li>
</ul>
<p>Votre R Studio s’ouvre et vous remarquez dans l’explorateur en bas à droite que votre repo git a été cloné.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Ce qu'il se passe sous le capot">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Ce qu’il se passe sous le capot
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Pour plus de détails, vous pouvez consulter la vidéo en bas de la page.</p>
<p>Prenons l’exemple de ce qu’il se passe en arrière plan lorsque vous lancez un service <code>Vscode-python</code> :</p>
<section id="construction-de-limage-docker" class="level4">
<h4 class="anchored" data-anchor-id="construction-de-limage-docker">Construction de l’image Docker</h4>
<p>Une image Docker est un paquet léger et autonome qui contient tout le nécessaire pour exécuter une application : le code, les bibliothèques, les dépendances, les variables d’environnement et les fichiers de configuration.</p>
<p>Les images Docker permettent de créer des environnements isolés et cohérents, garantissant ainsi la portabilité et la reproductibilité des applications.</p>
<ol type="1">
<li>Nous partons de l’<a href="https://github.com/InseeFrLab/images-datascience/blob/main/base/Dockerfile" target="_blank">image de base d’Onyxia</a>
<ul>
<li>ubuntu:22.04 et quelques éléments de config</li>
</ul></li>
<li>Nous ajoutons la couche <a href="https://github.com/InseeFrLab/images-datascience/blob/main/python-minimal/Dockerfile" target="_blank">python-minimal</a>
<ul>
<li>installation de python et quelques packages classiques</li>
</ul></li>
<li>Nous ajoutons la couche <a href="https://github.com/InseeFrLab/images-datascience/blob/main/python-datascience/Dockerfile" target="_blank">python-datascience</a>
<ul>
<li>Julia, Quarto et des packages de datascience (numpy, pandas…)</li>
</ul></li>
<li>Nous ajoutons la couche <a href="https://github.com/InseeFrLab/images-datascience/blob/main/vscode/Dockerfile" target="_blank">vscode</a>
<ul>
<li>Installation de Visual Studio Code et configuration</li>
</ul></li>
</ol>
</section>
<section id="dockerhub" class="level4">
<h4 class="anchored" data-anchor-id="dockerhub">DockerHub</h4>
<p>Cette image est construite et déposée sur DockerHub <a href="https://hub.docker.com/r/inseefrlab/onyxia-vscode-python" target="_blank">onyxia-vscode-python</a>.</p>
<p>Nous allons ensuite lancer une instance de cette image : un conteneur. Le conteneur est à l’image, ce que l’objet est à la classe.</p>
<p>Pour gérer tous les conteneurs lancés sur le datalab, nous avons besoin d’un orchestrateur : Kubernetes.</p>
</section>
<section id="chart-helm" class="level4">
<h4 class="anchored" data-anchor-id="chart-helm">Chart Helm</h4>
<p>Cependant, nous allons d’abord utiliser Helm pour faciliter le déploiement.</p>
<p>Helm simplifie le processus de déploiement d’applications sur Kubernetes en automatisant les tâches répétitives et en fournissant une gestion centralisée des configurations.</p>
<p>Le <a href="https://github.com/InseeFrLab/helm-charts-interactive-services/tree/main/charts/vscode-python" target="_blank">chart Helm vscode-python</a> est un ensemble de fichiers de configuration qui facilite le déploiement d’application dans un envrionnement Kubernetes.</p>
</section>
<section id="déploiement-sur-kube" class="level4">
<h4 class="anchored" data-anchor-id="déploiement-sur-kube">Déploiement sur Kube</h4>
<p>Kubernetes (K8s) est un système open-source qui automatise le déploiement, la mise à l’échelle et la gestion d’applications conteneurisées. C’est un orchestrateur de conteneurs.</p>
<p>K8s récupére via le chart Helm toutes les infos nécessaires et déploie le conteneur (créé à partir de l’image Docker) sur l’infra du datalab</p>
</section>
</div>
</div>
</div>
</section>
<section id="jouer-avec-votre-service" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="jouer-avec-votre-service"><span class="header-section-number">3.3</span> Jouer avec votre service</h3>
<ul class="task-list">
<li><label><input type="checkbox">File &gt; New File &gt; R Script</label></li>
<li><label><input type="checkbox">Enregistrez ce fichier sous le nom <em>tp1.R</em> dans votre repo <em>TP-datalab</em></label></li>
</ul>
</section>
<section id="accéder-à-votre-stockage" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="accéder-à-votre-stockage"><span class="header-section-number">3.4</span> Accéder à votre stockage</h3>
<p>Nous allons utiliser par exemple la librairie <code>aws.s3</code> pour accéder au stockage.</p>
<ul class="task-list">
<li><label><input type="checkbox">Chargez les librairies</label>
<ul>
<li><strong>aws.s3</strong> : permet d’interagir avec le service Amazon S3 pour la gestion et le stockage de fichiers en ligne.</li>
<li><strong>dplyr</strong> : fournit des fonctions simples et rapides pour la manipulation de données</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode R code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(aws.s3)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul class="task-list">
<li><label><input type="checkbox">Renseignez le nom de votre bucket (correspond à votre nom d’utilisateur)</label></li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode R code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>bucket_name <span class="ot">&lt;-</span> <span class="st">"&lt;username&gt;"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul class="task-list">
<li><label><input type="checkbox">Listez les fichiers de votre bucket</label></li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode R code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>aws.s3<span class="sc">::</span><span class="fu">get_bucket</span>(bucket_name, <span class="at">region =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul class="task-list">
<li><label><input type="checkbox">Listez les fichiers d’un dossier spécifique</label></li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode R code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>specific_folder <span class="ot">&lt;-</span> aws.s3<span class="sc">::</span><span class="fu">get_bucket</span>(bucket_name, </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">region =</span> <span class="st">""</span>, </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">prefix =</span> <span class="st">"diffusion/INSEE"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Affichage sous forme de dataframe</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">lapply</span>(specific_folder, <span class="cf">function</span>(x) {</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">FileName =</span> <span class="fu">basename</span>(x<span class="sc">$</span>Key), </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">Size =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(<span class="fu">as.numeric</span>(x<span class="sc">$</span>Size) <span class="sc">/</span> (<span class="dv">1024</span> <span class="sc">*</span> <span class="dv">1024</span>), <span class="dv">2</span>), <span class="st">" Mo"</span>), </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">LastModified =</span> <span class="fu">format</span>(<span class="fu">as.POSIXct</span>(x<span class="sc">$</span>LastModified, <span class="at">format=</span><span class="st">"%Y-%m-%dT%H:%M:%OSZ"</span>, <span class="at">tz=</span><span class="st">"UTC"</span>), <span class="st">"%Y.%m.%d %H:%M"</span>),</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul class="task-list">
<li><label><input type="checkbox">Lisez un fichier csv</label></li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode R code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> aws.s3<span class="sc">::</span><span class="fu">s3read_using</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">FUN =</span> data.table<span class="sc">::</span>fread,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> <span class="st">"/diffusion/INSEE/dpt2022_csv.zip"</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">bucket =</span> bucket_name,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">"region"</span> <span class="ot">=</span> <span class="st">""</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul class="task-list">
<li><label><input type="checkbox">Requêtez les données</label></li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode R code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Top 10 des prénoms féminins en 2021</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>top10f2021 <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sexe <span class="sc">==</span> <span class="dv">2</span>, annais <span class="sc">==</span> <span class="dv">2021</span>, preusuel <span class="sc">!=</span> <span class="st">"_PRENOMS_RARES"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(preusuel) <span class="sc">|&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">nombre_total =</span> <span class="fu">sum</span>(nombre)) <span class="sc">|&gt;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(nombre_total)) <span class="sc">|&gt;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul class="task-list">
<li><label><input type="checkbox">Exportez vos résultats vers MinIO</label></li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode R code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>aws.s3<span class="sc">::</span><span class="fu">s3write_using</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  top10f2021,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">FUN =</span> data.table<span class="sc">::</span>fwrite,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">";"</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">col.names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> <span class="st">"/diffusion/INSEE/output.csv"</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">bucket =</span> <span class="st">"ludo2ne"</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">"region"</span> <span class="ot">=</span> <span class="st">""</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul class="task-list">
<li><label><input type="checkbox">Sur le SSP cloud, allez dans Mes fichiers &gt; diffusion &gt; INSEE</label>
<ul>
<li>le fichier <em>output.csv</em> a été généré</li>
<li>rafraichissez la page si besoin</li>
</ul></li>
<li><label><input type="checkbox">Double-cliquez sur ce fichier pour en avoir un aperçu</label></li>
</ul>
</section>
<section id="client-minio" class="level3" data-number="3.5">
<h3 data-number="3.5" class="anchored" data-anchor-id="client-minio"><span class="header-section-number">3.5</span> Client MinIO</h3>
<p>Le <a href="https://min.io/docs/minio/linux/reference/minio-mc.html" target="_blank">client MinIO</a> installé et <u>utilisable depuis le terminal</u> permet également d’interagir avec vos fichiers.</p>
<ul class="task-list">
<li><label><input type="checkbox"><code>mc ls s3/&lt;username&gt;/diffusion</code> : pour lister le contenu de votre dossier diffusion</label></li>
<li><label><input type="checkbox"><code>mc cp s3/&lt;username&gt;/diffusion/INSEE/dpt2022.csv .</code> : pour copier le fichier depuis s3 dans votre dossier courant</label>
<ul>
<li>le fichier apparait dans votre explorer</li>
</ul></li>
<li><label><input type="checkbox">Supprimez ce fichier : <code>rm dpt2022.csv</code></label>
<ul>
<li>Car importer les fichiers de données dans son espace de travail n’est pas une bonne pratique</li>
</ul></li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>La commande <code>mc --help</code> liste toutes les commandes possibles (ESPACE pour défiler, CTRL+C pour sortir)</p>
</div>
</div>
</section>
<section id="sauver-son-code" class="level3" data-number="3.6">
<h3 data-number="3.6" class="anchored" data-anchor-id="sauver-son-code"><span class="header-section-number">3.6</span> Sauver son code</h3>
<ul class="task-list">
<li><label><input type="checkbox">Allez dans le terminal</label></li>
<li><label><input type="checkbox">Positionnez-vous dans le repo : <code>cd /home/onyxia/work/TP-datalab</code></label></li>
<li><label><input type="checkbox"><code>git status</code> pour voir l’état actuel</label>
<ul>
<li>le fichier <em>tp1.R</em> doit apparaître dans les <em>Untracked files</em></li>
</ul></li>
<li><label><input type="checkbox">Ajoutez ce fichier à l’index : <code>git add .</code></label></li>
<li><label><input type="checkbox">Créez un commit : <code>git commit -m "création fichier tp1"</code></label></li>
<li><label><input type="checkbox">Poussez ce commit vers votre dépôt distant (GitHub)</label>
<ul>
<li>Vous pouvez vérifier sur GitHub que votre fichier <em>tp1.R</em> est bien présent</li>
</ul></li>
</ul>
</section>
<section id="surveiller-son-service" class="level3" data-number="3.7">
<h3 data-number="3.7" class="anchored" data-anchor-id="surveiller-son-service"><span class="header-section-number">3.7</span> Surveiller son service</h3>
<ul class="task-list">
<li><label><input type="checkbox">Sur la page du Datalab, allez dans <code>Mes services</code></label></li>
<li><label><input type="checkbox">Cliquez sur le nom du service (Rstudio)</label></li>
<li><label><input type="checkbox">Cliquez sur <code>Surveillance externe</code></label></li>
</ul>
<p>Vous arrivez sur la page de l’outil <strong>Grafana</strong> qui permet d’observer les métriques de votre service.</p>
</section>
<section id="terminer-son-service" class="level3" data-number="3.8">
<h3 data-number="3.8" class="anchored" data-anchor-id="terminer-son-service"><span class="header-section-number">3.8</span> Terminer son service</h3>
<p>Une fois vos travaux terminés, il est temps de libérer les ressources réservées.</p>
<ul class="task-list">
<li><label><input type="checkbox">Dans <em>Mes services</em>, mettez votre service à la poubelle</label></li>
</ul>
<p>De toute manière, vous pouvez aisément reproduire votre travail plus tard :</p>
<ul>
<li>Votre code est sur GitHub</li>
<li>Vos données sont sur MinIO</li>
<li>Il suffit de relancer un nouveau service</li>
</ul>
</section>
</section>
<section id="les-secrets" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="les-secrets"><span class="header-section-number">4</span> Les secrets</h2>
<p>Certains éléments ne doivent pas être diffusés dans votre code (jetons d’accès, mots de passe…).</p>
<p>Pour éviter d’avoir à nettoyer votre code à chaque fois que vous le poussez sur GitHub, le datalab propose de gérer vos secrets.</p>
<section id="créer-un-secret" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="créer-un-secret"><span class="header-section-number">4.1</span> Créer un secret</h3>
<ul class="task-list">
<li><label><input type="checkbox">Allez dans <em>Mes secrets</em></label></li>
<li><label><input type="checkbox">Créez un <code>Nouveau secret</code> nommé <em>projet_patate</em></label></li>
<li><label><input type="checkbox">Double-cliquez pour ouvrir ce secret</label></li>
<li><label><input type="checkbox"><code>Ajoutez une variable</code></label>
<ul>
<li>Nom : PATATE_TOKEN</li>
<li>Valeur : 123456</li>
<li>Cliquez sur <span class="emoji" data-emoji="white_check_mark">✅</span> pour valider</li>
</ul></li>
<li><label><input type="checkbox">Ajoutez une autre variable</label>
<ul>
<li>Nom : PATATE_PORT</li>
<li>Valeur : 5236</li>
<li>Cliquez sur <span class="emoji" data-emoji="white_check_mark">✅</span> pour valider</li>
</ul></li>
</ul>
</section>
<section id="utiliser-dans-un-service" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="utiliser-dans-un-service"><span class="header-section-number">4.2</span> Utiliser dans un service</h3>
<ul class="task-list">
<li><label><input type="checkbox">Préparez le lancement d’un service Rstudio</label></li>
<li><label><input type="checkbox">Dans la configuration, allez dans l’onglet <code>Vault</code></label></li>
<li><label><input type="checkbox">secret : <em>projet_patate</em></label></li>
<li><label><input type="checkbox">Lancez le service</label></li>
</ul>
<p>Dans votre servives, les deux variables d’environnement ont été créées.</p>
<ul class="task-list">
<li><label><input type="checkbox">Vérifiez leur présence via le terminal : <code>env | grep PATATE</code> ou <code>echo $PATATE_TOKEN</code></label></li>
<li><label><input type="checkbox">Obtenez la valeur dans un script R : <code>token &lt;- Sys.getenv("PATATE_TOKEN")</code></label></li>
</ul>
</section>
</section>
<section id="pour-aller-plus-loin" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="pour-aller-plus-loin">Pour aller plus loin</h2>
<section id="le-projet-onyxia-de-a-à-z" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="le-projet-onyxia-de-a-à-z">Le projet Onyxia de A à Z</h3>
<p>Une présentation complète du projet Onyxia au Devoxx 2023, de sa philosophie et de son fonctionnement par Olivier LEVITT, Joseph GARRONE et Comte FREDERIC.</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/GXINfnVB21E" title="Construisons un cloud opensource pour le datascientist" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</section>
<section id="le-projet-onyxia-version-courte" class="level3 unnumbered unlisted">
<h3 class="unnumbered unlisted anchored" data-anchor-id="le-projet-onyxia-version-courte">Le projet Onyxia (version courte)</h3>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/sOOVg4I19BI" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</section>
</section>
<section id="bibliographie" class="level2 unnumbered unlisted">
<h2 class="unnumbered unlisted anchored" data-anchor-id="bibliographie">Bibliographie</h2>
<ul>
<li><a href="https://book.utilitr.org/01_R_Insee/Fiche_utiliser_Rstudio_SSPCloud.html" target="_blank">Utiliser RStudio sur l’environnement SSP Cloud</a>, UtilitR</li>
<li><a href="https://www.sspcloud.fr/formation" target="_blank">Découverte du Datalab</a>, Plateforme SSP Cloud</li>
<li><a href="https://github.com/TheAIWizard/Hands-on-Spark-Lab/blob/main/First-steps-with-cloud-computing/First-steps-with-cloud-computing.md" target="_blank">Découverte d’Onyxia et de son datalab SSP Cloud</a>, Nathan Randriamanana</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = true;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/ludo2ne\.github\.io\/ENSAI-2A-Big-Data\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Website built with <a href="https://quarto.org/" class="external" target="_blank">Quarto</a> <br> <a href="https://github.com/ludo2ne/ENSAI-2A-Big-Data" class="external" target="_blank">Source code</a></p>
</div>
  </div>
</footer>




</body></html>